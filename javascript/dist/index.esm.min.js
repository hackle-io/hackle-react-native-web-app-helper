import{createInstance as e,DefaultBrowserPropertyProvider as t,Decision as r,DecisionReason as n,FeatureFlagDecision as o}from"@hackler/javascript-sdk";var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},s(e,t)};function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function u(e,t,r,n){return new(r||(r=Promise))(function(o,s){function i(e){try{c(n.next(e))}catch(e){s(e)}}function u(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,u)}c((n=n.apply(e,t||[])).next())})}function c(e,t){var r,n,o,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(c){return function(u){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(s=0)),s;)try{if(r=1,n&&(o=2&u[0]?n.return:u[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,u[1])).done)return o;switch(n=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return s.label++,{value:u[1],done:!1};case 5:s.label++,n=u[1],u=[0];continue;case 7:u=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){s=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){s.label=u[1];break}if(6===u[0]&&s.label<o[1]){s.label=o[1],o=u;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(u);break}o[2]&&s.ops.pop(),s.trys.pop();continue}u=t.call(e,s)}catch(e){u=[6,e],n=0}finally{r=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,c])}}}"function"==typeof SuppressedError&&SuppressedError;var a=function(){function e(){this.listeners={}}return e.prototype.on=function(e,t){this.listeners[e]=(this.listeners[e]||[]).concat(t)},e.prototype.off=function(e,t){this.listeners[e]=(this.listeners[e]||[]).filter(function(e){return e!==t})},e.prototype.emit=function(e,t){(this.listeners[e]||[]).forEach(function(e){e(t)})},e}();const p=[];for(let e=0;e<256;++e)p.push((e+256).toString(16).slice(1));let f;const l=new Uint8Array(16);var d={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function h(e,t,r){if(d.randomUUID&&!e)return d.randomUUID();const n=(e=e||{}).random??e.rng?.()??function(){if(!f){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");f=crypto.getRandomValues.bind(crypto)}return f(l)}();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=15&n[6]|64,n[8]=63&n[8]|128,function(e,t=0){return(p[e[t+0]]+p[e[t+1]]+p[e[t+2]]+p[e[t+3]]+"-"+p[e[t+4]]+p[e[t+5]]+"-"+p[e[t+6]]+p[e[t+7]]+"-"+p[e[t+8]]+p[e[t+9]]+"-"+p[e[t+10]]+p[e[t+11]]+p[e[t+12]]+p[e[t+13]]+p[e[t+14]]+p[e[t+15]]).toLowerCase()}(n)}var v=function(){function e(e){this.parameters=e,this.parameters=e}return e.prototype.get=function(e,t){var r=this.parameters[e];return null==r?t:null==t||typeof r==typeof t?r:t},e}(),m=function(){function e(e){this.configFetcher=e,this.configFetcher=e}return e.prototype.get=function(e,t){return u(this,void 0,void 0,function(){var r,n,o,s;return c(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),r=typeof t,[4,this.configFetcher(e,t,r)];case 1:if(null==(n=i.sent()))throw new Error("invoke result data not exists");switch(o=n.configValue,r){case"number":return[2,Number(o)];case"boolean":return[2,Boolean(o)];default:return[2,o]}case 2:return s=i.sent(),console.error("Unexpected exception while deciding remote config parameter[".concat(e,"]. Returning default value. : ").concat(s)),[2,t];case 3:return[2]}})})},e}(),g=function(){function e(e,t,r,n){this.id=e,this.type=t,this.payload=r,this.browserProperties=n}return e.parseOrNull=function(t){try{if(e.MESSAGE_FIELD_NAME in t){var r=t[e.MESSAGE_FIELD_NAME];return new e(r.id,r.type,r.payload,r.browserProperties)}return null}catch(e){return null}},e.from=function(t,r,n,o){return new e(t,r,n,o)},e.prototype.toDto=function(){var t;return(t={})[e.MESSAGE_FIELD_NAME]={id:this.id,type:this.type,payload:this.payload,browserProperties:this.browserProperties},t},e.MESSAGE_FIELD_NAME="_hackle_message",e}();function y(e,t){var r=t.timeoutMillis,n=void 0===r?5e3:r,o=t.onTimeout;return new Promise(function(t,r){e(t,r),setTimeout(function(){o(t,r)},n)})}var w=function(){function e(){this.injectFlag="_hackle_injected"}return e.prototype.isInjectedEnvironment=function(){return!("undefined"==typeof window||!window.ReactNativeWebView)&&!0===window[this.injectFlag]},e.prototype.createInstance=function(e,t){if(this.isInjectedEnvironment()){var r=new P(window.ReactNativeWebView);return new U(e,t,r)}return new b(e,t)},e}(),P=function(){function e(e){this.port=e,this.cleanUp=function(){}}return e.prototype.addEventListener=function(e){window.addEventListener("message",e,!0),this.cleanUp=function(){return window.removeEventListener("message",e,!0)}},e}(),U=function(e){function s(t,r,n){var o=e.call(this)||this;return o.sdkKey=t,o.config=r,o.messageTransceiver=n,o.messageFieldName="_hackle_message",o.resolverRecord=new Map,o.messageTransceiver.addEventListener(function(e){var t,r=e;if(r.data&&"undefined"!==r.data)try{var n=JSON.parse(r.data),s=g.parseOrNull(n);if(!s)throw new Error("Invalid message");var i=s.id,u=s.payload;null===(t=o.resolverRecord.get(i))||void 0===t||t(u),o.resolverRecord.delete(i)}catch(e){console.log("[DEBUG] Hackle: Failed to parse message. If message not sent by hackle, please ignore this. ".concat(e))}}),o}return i(s,e),s.prototype.onInitialized=function(e){return Promise.resolve({success:!0})},s.prototype.getBrowserProperties=function(){return(new t).getBrowserProperties()},s.prototype.createMessage=function(e){return JSON.stringify(e.toDto())},s.prototype.createId=function(){return h()},s.prototype.getSessionId=function(){return u(this,void 0,void 0,function(){var e,t=this;return c(this,function(r){switch(r.label){case 0:return e=this.createId(),[4,y(function(r){t.messageTransceiver.port.postMessage(t.createMessage(g.from(e,"getSessionId",null,t.getBrowserProperties()))),t.resolverRecord.set(e,r)},{onTimeout:function(e){return e({sessionId:""})}})];case 1:return[2,r.sent().sessionId]}})})},s.prototype.getUser=function(){return u(this,void 0,void 0,function(){var e,t=this;return c(this,function(r){switch(r.label){case 0:return e=this.createId(),[4,y(function(r){t.messageTransceiver.port.postMessage(t.createMessage(g.from(e,"getUser",null,t.getBrowserProperties()))),t.resolverRecord.set(e,r)},{onTimeout:function(e){return e({user:{}})}})];case 1:return[2,r.sent().user]}})})},s.prototype.emitUserUpdated=function(){this.emit("user-updated",JSON.stringify(this.getUser()))},s.prototype.setUser=function(e){return u(this,void 0,void 0,function(){var t,r=this;return c(this,function(n){return t=this.createId(),[2,y(function(n){r.messageTransceiver.port.postMessage(r.createMessage(g.from(t,"setUser",{user:e},r.getBrowserProperties()))),r.resolverRecord.set(t,n)},{onTimeout:function(e){return e()}}).then(function(){r.emitUserUpdated()})]})})},s.prototype.setUserId=function(e){return u(this,void 0,void 0,function(){var t,r=this;return c(this,function(n){return t=this.createId(),[2,y(function(n){var o=e;null==e&&(o=null),r.messageTransceiver.port.postMessage(r.createMessage(g.from(t,"setUserId",{userId:o},r.getBrowserProperties()))),r.resolverRecord.set(t,n)},{onTimeout:function(e){return e()}}).then(function(){r.emitUserUpdated()})]})})},s.prototype.setDeviceId=function(e){return u(this,void 0,void 0,function(){var t,r=this;return c(this,function(n){return t=this.createId(),[2,y(function(n){r.messageTransceiver.port.postMessage(r.createMessage(g.from(t,"setDeviceId",{deviceId:e},r.getBrowserProperties()))),r.resolverRecord.set(t,n)},{onTimeout:function(e){return e()}}).then(function(){r.emitUserUpdated()})]})})},s.prototype.setUserProperty=function(e,t){return u(this,void 0,void 0,function(){var r,n=this;return c(this,function(o){return r=this.createId(),[2,y(function(o){n.messageTransceiver.port.postMessage(n.createMessage(g.from(r,"setUserProperty",{key:e,value:t},n.getBrowserProperties()))),n.resolverRecord.set(r,o)},{onTimeout:function(e){return e()}}).then(function(){n.emitUserUpdated()})]})})},s.prototype.setUserProperties=function(e){return u(this,void 0,void 0,function(){var t,r=this;return c(this,function(n){return t=this.createId(),[2,y(function(n){r.messageTransceiver.port.postMessage(r.createMessage(g.from(t,"setUserProperties",{properties:e},r.getBrowserProperties()))),r.resolverRecord.set(t,n)},{onTimeout:function(e){return e()}}).then(function(){r.emitUserUpdated()})]})})},s.prototype.updateUserProperties=function(e){return u(this,void 0,void 0,function(){var t,r=this;return c(this,function(n){return t=this.createId(),[2,y(function(n){r.messageTransceiver.port.postMessage(r.createMessage(g.from(t,"updateUserProperties",{operations:e.toRecord()},r.getBrowserProperties()))),r.resolverRecord.set(t,n)},{onTimeout:function(e){return e()}}).then(function(){r.emitUserUpdated()})]})})},s.prototype.updatePushSubscriptions=function(e){var t=this,r=this.createId();return y(function(n){t.messageTransceiver.port.postMessage(t.createMessage(g.from(r,"updatePushSubscriptions",{operations:e.toRecord()},t.getBrowserProperties()))),t.resolverRecord.set(r,n)},{onTimeout:function(e){return e()}})},s.prototype.updateSmsSubscriptions=function(e){var t=this,r=this.createId();return y(function(n){t.messageTransceiver.port.postMessage(t.createMessage(g.from(r,"updateSmsSubscriptions",{operations:e.toRecord()},t.getBrowserProperties()))),t.resolverRecord.set(r,n)},{onTimeout:function(e){return e()}})},s.prototype.updateKakaoSubscriptions=function(e){var t=this,r=this.createId();return y(function(n){t.messageTransceiver.port.postMessage(t.createMessage(g.from(r,"updateKakaoSubscriptions",{operations:e.toRecord()},t.getBrowserProperties()))),t.resolverRecord.set(r,n)},{onTimeout:function(e){return e()}})},s.prototype.setPhoneNumber=function(e){var t=this,r=this.createId();return y(function(n){t.messageTransceiver.port.postMessage(t.createMessage(g.from(r,"setPhoneNumber",{phoneNumber:e},t.getBrowserProperties()))),t.resolverRecord.set(r,n)},{onTimeout:function(e){return e()}})},s.prototype.unsetPhoneNumber=function(){var e=this,t=this.createId();return y(function(r){e.messageTransceiver.port.postMessage(e.createMessage(g.from(t,"unsetPhoneNumber",null,e.getBrowserProperties()))),e.resolverRecord.set(t,r)},{onTimeout:function(e){return e()}})},s.prototype.resetUser=function(){return u(this,void 0,void 0,function(){var e,t=this;return c(this,function(r){return e=this.createId(),[2,y(function(r){t.messageTransceiver.port.postMessage(t.createMessage(g.from(e,"resetUser",null,t.getBrowserProperties()))),t.resolverRecord.set(e,r)},{onTimeout:function(e){return e()}}).then(function(){t.emitUserUpdated()})]})})},s.prototype.variation=function(e){return u(this,void 0,void 0,function(){var t,r=this;return c(this,function(n){switch(n.label){case 0:return t=this.createId(),[4,y(function(n){r.messageTransceiver.port.postMessage(r.createMessage(g.from(t,"variation",{experimentKey:e},r.getBrowserProperties()))),r.resolverRecord.set(t,n)},{onTimeout:function(e){return e({variation:"A"})}})];case 1:return[2,n.sent().variation]}})})},s.prototype.variationDetail=function(e){return u(this,void 0,void 0,function(){var t,o,s,i,u,a=this;return c(this,function(c){switch(c.label){case 0:t=this.createId(),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,y(function(r){a.messageTransceiver.port.postMessage(a.createMessage(g.from(t,"variationDetail",{experimentKey:e},a.getBrowserProperties()))),a.resolverRecord.set(t,r)},{onTimeout:function(e,t){return t()}})];case 2:return o=c.sent(),s=o.variation,i=o.reason,u=o.parameters,[2,r.of(s,i,new v(null!=u?u:{}))];case 3:return c.sent(),[2,r.of("A",n.EXCEPTION)];case 4:return[2]}})})},s.prototype.isFeatureOn=function(e){return u(this,void 0,void 0,function(){var t,r=this;return c(this,function(n){switch(n.label){case 0:return t=this.createId(),[4,y(function(n){r.messageTransceiver.port.postMessage(r.createMessage(g.from(t,"isFeatureOn",{featureKey:e},r.getBrowserProperties()))),r.resolverRecord.set(t,n)},{onTimeout:function(e){return e({isOn:!1})}})];case 1:return[2,n.sent().isOn]}})})},s.prototype.featureFlagDetail=function(e){return u(this,void 0,void 0,function(){var t,r,s,i,u,a=this;return c(this,function(c){switch(c.label){case 0:t=this.createId(),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,y(function(r){a.messageTransceiver.port.postMessage(a.createMessage(g.from(t,"featureFlagDetail",{featureKey:e},a.getBrowserProperties()))),a.resolverRecord.set(t,r)},{onTimeout:function(e,t){return t()}})];case 2:return r=c.sent(),s=r.isOn,i=r.reason,u=r.parameters,[2,new o(s,i,new v(null!=u?u:{}),void 0)];case 3:return c.sent(),[2,o.off(n.EXCEPTION)];case 4:return[2]}})})},s.prototype.track=function(e){var t=this,r=this.createId();return y(function(n){t.messageTransceiver.port.postMessage(t.createMessage(g.from(r,"track",{event:e},t.getBrowserProperties()))),t.resolverRecord.set(r,n)},{onTimeout:function(e){return e()}})},s.prototype.trackPageView=function(){return u(this,void 0,void 0,function(){return c(this,function(e){return[2]})})},s.prototype.remoteConfig=function(){var e=this;return new m(function(t,r,n){var o=e.createId();return y(function(s){e.messageTransceiver.port.postMessage(e.createMessage(g.from(o,"remoteConfig",{key:t,defaultValue:r,valueType:n},e.getBrowserProperties()))),e.resolverRecord.set(o,s)},{onTimeout:function(e){return e(r)}})})},s.prototype.showUserExplorer=function(){var e=this,t=this.createId();return y(function(r){e.messageTransceiver.port.postMessage(e.createMessage(g.from(t,"showUserExplorer",null,e.getBrowserProperties()))),e.resolverRecord.set(t,r)},{onTimeout:function(e){return e()}})},s.prototype.hideUserExplorer=function(){return u(this,void 0,void 0,function(){var e,t=this;return c(this,function(r){return e=this.createId(),[2,y(function(r){t.messageTransceiver.port.postMessage(t.createMessage(g.from(e,"hideUserExplorer",null,t.getBrowserProperties()))),t.resolverRecord.set(e,r)},{onTimeout:function(e){return e()}})]})})},s.prototype.fetch=function(){var e=this,t=this.createId();return y(function(r){e.messageTransceiver.port.postMessage(e.createMessage(g.from(t,"fetch",null,e.getBrowserProperties()))),e.resolverRecord.set(t,r)},{onTimeout:function(e){return e()}})},s.prototype.getDisplayedInAppMessage=function(){return console.log("[DEBUG] Hackle: getDisplayedInAppMessage is not supported in React Native WebView environment."),Promise.resolve(null)},s}(a),b=function(t){function r(r,n){var o=t.call(this)||this;return o.client=e(r,n),o}return i(r,t),r.prototype.emitUserUpdated=function(){this.emit("user-updated",JSON.stringify(this.getUser()))},r.prototype.getSessionId=function(){return Promise.resolve(this.client.getSessionId())},r.prototype.getUser=function(){return Promise.resolve(this.client.getUser())},r.prototype.setUser=function(e){return u(this,void 0,void 0,function(){var t=this;return c(this,function(r){return[2,Promise.resolve(this.client.setUser(e)).then(function(){t.emitUserUpdated()})]})})},r.prototype.setUserId=function(e){return u(this,void 0,void 0,function(){var t=this;return c(this,function(r){return[2,Promise.resolve(this.client.setUserId(e)).then(function(){t.emitUserUpdated()})]})})},r.prototype.setDeviceId=function(e){return u(this,void 0,void 0,function(){var t=this;return c(this,function(r){return[2,Promise.resolve(this.client.setDeviceId(e)).then(function(){t.emitUserUpdated()})]})})},r.prototype.setUserProperty=function(e,t){return u(this,void 0,void 0,function(){var r=this;return c(this,function(n){return[2,Promise.resolve(this.client.setUserProperty(e,t)).then(function(){r.emitUserUpdated()})]})})},r.prototype.setUserProperties=function(e){return u(this,void 0,void 0,function(){var t=this;return c(this,function(r){return[2,Promise.resolve(this.client.setUserProperties(e)).then(function(){t.emitUserUpdated()})]})})},r.prototype.updateUserProperties=function(e){return u(this,void 0,void 0,function(){var t=this;return c(this,function(r){return[2,Promise.resolve(this.client.updateUserProperties(e)).then(function(){t.emitUserUpdated()})]})})},r.prototype.updatePushSubscriptions=function(e){return Promise.resolve(this.client.updatePushSubscriptions(e))},r.prototype.updateSmsSubscriptions=function(e){return Promise.resolve(this.client.updateSmsSubscriptions(e))},r.prototype.updateKakaoSubscriptions=function(e){return Promise.resolve(this.client.updateKakaoSubscriptions(e))},r.prototype.setPhoneNumber=function(e){return Promise.resolve(this.client.setPhoneNumber(e))},r.prototype.unsetPhoneNumber=function(){return Promise.resolve(this.client.unsetPhoneNumber())},r.prototype.resetUser=function(){return u(this,void 0,void 0,function(){var e=this;return c(this,function(t){return[2,Promise.resolve(this.client.resetUser()).then(function(){e.emitUserUpdated()})]})})},r.prototype.variation=function(e){return Promise.resolve(this.client.variation(e))},r.prototype.variationDetail=function(e){return Promise.resolve(this.client.variationDetail(e))},r.prototype.isFeatureOn=function(e){return Promise.resolve(this.client.isFeatureOn(e))},r.prototype.featureFlagDetail=function(e){return Promise.resolve(this.client.featureFlagDetail(e))},r.prototype.track=function(e){return Promise.resolve(this.client.track(e))},r.prototype.trackPageView=function(e){return Promise.resolve(this.client.trackPageView(e))},r.prototype.remoteConfig=function(){var e=this;return new m(function(t,r,n){var o=e.client.remoteConfig().get(t,r);return Promise.resolve({configValue:o})})},r.prototype.showUserExplorer=function(){return Promise.resolve(this.client.showUserExplorer())},r.prototype.hideUserExplorer=function(){return Promise.resolve(this.client.hideUserExplorer())},r.prototype.fetch=function(){return Promise.resolve(this.client.fetch())},r.prototype.onInitialized=function(e){return this.client.onInitialized(e)},r.prototype.getDisplayedInAppMessage=function(){return Promise.resolve(this.client.getDisplayedInAppMessageView())},r}(a);export{w as default};
