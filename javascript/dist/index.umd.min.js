!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("@hackler/javascript-sdk")):"function"==typeof define&&define.amd?define(["@hackler/javascript-sdk"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).HackleManager=t(e.Hackle)}(this,function(e){"use strict";var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},t(e,r)};function r(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}function n(e,t,r,n){return new(r||(r=Promise))(function(o,s){function i(e){try{c(n.next(e))}catch(e){s(e)}}function u(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,u)}c((n=n.apply(e,t||[])).next())})}function o(e,t){var r,n,o,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=u(0),i.throw=u(1),i.return=u(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(c){return function(u){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(s=0)),s;)try{if(r=1,n&&(o=2&u[0]?n.return:u[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,u[1])).done)return o;switch(n=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return s.label++,{value:u[1],done:!1};case 5:s.label++,n=u[1],u=[0];continue;case 7:u=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){s=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){s.label=u[1];break}if(6===u[0]&&s.label<o[1]){s.label=o[1],o=u;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(u);break}o[2]&&s.ops.pop(),s.trys.pop();continue}u=t.call(e,s)}catch(e){u=[6,e],n=0}finally{r=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,c])}}}"function"==typeof SuppressedError&&SuppressedError;var s=function(){function e(){this.listeners={}}return e.prototype.on=function(e,t){this.listeners[e]=(this.listeners[e]||[]).concat(t)},e.prototype.off=function(e,t){this.listeners[e]=(this.listeners[e]||[]).filter(function(e){return e!==t})},e.prototype.emit=function(e,t){(this.listeners[e]||[]).forEach(function(e){e(t)})},e}();const i=[];for(let e=0;e<256;++e)i.push((e+256).toString(16).slice(1));let u;const c=new Uint8Array(16);var a={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function p(e,t,r){if(a.randomUUID&&!e)return a.randomUUID();const n=(e=e||{}).random??e.rng?.()??function(){if(!u){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");u=crypto.getRandomValues.bind(crypto)}return u(c)}();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=15&n[6]|64,n[8]=63&n[8]|128,function(e,t=0){return(i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]).toLowerCase()}(n)}var f=function(){function e(e){this.parameters=e,this.parameters=e}return e.prototype.get=function(e,t){var r=this.parameters[e];return null==r?t:null==t||typeof r==typeof t?r:t},e}(),l=function(){function e(e){this.configFetcher=e,this.configFetcher=e}return e.prototype.get=function(e,t){return n(this,void 0,void 0,function(){var r,n,s,i;return o(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),r=typeof t,[4,this.configFetcher(e,t,r)];case 1:if(null==(n=o.sent()))throw new Error("invoke result data not exists");switch(s=n.configValue,r){case"number":return[2,Number(s)];case"boolean":return[2,Boolean(s)];default:return[2,s]}case 2:return i=o.sent(),console.error("Unexpected exception while deciding remote config parameter[".concat(e,"]. Returning default value. : ").concat(i)),[2,t];case 3:return[2]}})})},e}(),d=function(){function e(e,t,r,n){this.id=e,this.type=t,this.payload=r,this.browserProperties=n}return e.parseOrNull=function(t){try{if(e.MESSAGE_FIELD_NAME in t){var r=t[e.MESSAGE_FIELD_NAME];return new e(r.id,r.type,r.payload,r.browserProperties)}return null}catch(e){return null}},e.from=function(t,r,n,o){return new e(t,r,n,o)},e.prototype.toDto=function(){var t;return(t={})[e.MESSAGE_FIELD_NAME]={id:this.id,type:this.type,payload:this.payload,browserProperties:this.browserProperties},t},e.MESSAGE_FIELD_NAME="_hackle_message",e}();function h(e,t){var r=t.timeoutMillis,n=void 0===r?5e3:r,o=t.onTimeout;return new Promise(function(t,r){e(t,r),setTimeout(function(){o(t,r)},n)})}var v=function(){function e(){this.injectFlag="_hackle_injected"}return e.prototype.isInjectedEnvironment=function(){return!("undefined"==typeof window||!window.ReactNativeWebView)&&!0===window[this.injectFlag]},e.prototype.createInstance=function(e,t){if(this.isInjectedEnvironment()){var r=new m(window.ReactNativeWebView);return new g(e,t,r)}return new y(e,t)},e}(),m=function(){function e(e){this.port=e,this.cleanUp=function(){}}return e.prototype.addEventListener=function(e){window.addEventListener("message",e,!0),this.cleanUp=function(){return window.removeEventListener("message",e,!0)}},e}(),g=function(t){function s(e,r,n){var o=t.call(this)||this;return o.sdkKey=e,o.config=r,o.messageTransceiver=n,o.messageFieldName="_hackle_message",o.resolverRecord=new Map,o.messageTransceiver.addEventListener(function(e){var t,r=e;if(r.data&&"undefined"!==r.data)try{var n=JSON.parse(r.data),s=d.parseOrNull(n);if(!s)throw new Error("Invalid message");var i=s.id,u=s.payload;null===(t=o.resolverRecord.get(i))||void 0===t||t(u),o.resolverRecord.delete(i)}catch(e){console.log("[DEBUG] Hackle: Failed to parse message. If message not sent by hackle, please ignore this. ".concat(e))}}),o}return r(s,t),s.prototype.onInitialized=function(e){return Promise.resolve({success:!0})},s.prototype.getBrowserProperties=function(){return(new e.DefaultBrowserPropertyProvider).getBrowserProperties()},s.prototype.createMessage=function(e){return JSON.stringify(e.toDto())},s.prototype.createId=function(){return p()},s.prototype.getSessionId=function(){return n(this,void 0,void 0,function(){var e,t=this;return o(this,function(r){switch(r.label){case 0:return e=this.createId(),[4,h(function(r){t.messageTransceiver.port.postMessage(t.createMessage(d.from(e,"getSessionId",null,t.getBrowserProperties()))),t.resolverRecord.set(e,r)},{onTimeout:function(e){return e({sessionId:""})}})];case 1:return[2,r.sent().sessionId]}})})},s.prototype.getUser=function(){return n(this,void 0,void 0,function(){var e,t=this;return o(this,function(r){switch(r.label){case 0:return e=this.createId(),[4,h(function(r){t.messageTransceiver.port.postMessage(t.createMessage(d.from(e,"getUser",null,t.getBrowserProperties()))),t.resolverRecord.set(e,r)},{onTimeout:function(e){return e({user:{}})}})];case 1:return[2,r.sent().user]}})})},s.prototype.emitUserUpdated=function(){this.emit("user-updated",JSON.stringify(this.getUser()))},s.prototype.setUser=function(e){return n(this,void 0,void 0,function(){var t,r=this;return o(this,function(n){return t=this.createId(),[2,h(function(n){r.messageTransceiver.port.postMessage(r.createMessage(d.from(t,"setUser",{user:e},r.getBrowserProperties()))),r.resolverRecord.set(t,n)},{onTimeout:function(e){return e()}}).then(function(){r.emitUserUpdated()})]})})},s.prototype.setUserId=function(e){return n(this,void 0,void 0,function(){var t,r=this;return o(this,function(n){return t=this.createId(),[2,h(function(n){var o=e;null==e&&(o=null),r.messageTransceiver.port.postMessage(r.createMessage(d.from(t,"setUserId",{userId:o},r.getBrowserProperties()))),r.resolverRecord.set(t,n)},{onTimeout:function(e){return e()}}).then(function(){r.emitUserUpdated()})]})})},s.prototype.setDeviceId=function(e){return n(this,void 0,void 0,function(){var t,r=this;return o(this,function(n){return t=this.createId(),[2,h(function(n){r.messageTransceiver.port.postMessage(r.createMessage(d.from(t,"setDeviceId",{deviceId:e},r.getBrowserProperties()))),r.resolverRecord.set(t,n)},{onTimeout:function(e){return e()}}).then(function(){r.emitUserUpdated()})]})})},s.prototype.setUserProperty=function(e,t){return n(this,void 0,void 0,function(){var r,n=this;return o(this,function(o){return r=this.createId(),[2,h(function(o){n.messageTransceiver.port.postMessage(n.createMessage(d.from(r,"setUserProperty",{key:e,value:t},n.getBrowserProperties()))),n.resolverRecord.set(r,o)},{onTimeout:function(e){return e()}}).then(function(){n.emitUserUpdated()})]})})},s.prototype.setUserProperties=function(e){return n(this,void 0,void 0,function(){var t,r=this;return o(this,function(n){return t=this.createId(),[2,h(function(n){r.messageTransceiver.port.postMessage(r.createMessage(d.from(t,"setUserProperties",{properties:e},r.getBrowserProperties()))),r.resolverRecord.set(t,n)},{onTimeout:function(e){return e()}}).then(function(){r.emitUserUpdated()})]})})},s.prototype.updateUserProperties=function(e){return n(this,void 0,void 0,function(){var t,r=this;return o(this,function(n){return t=this.createId(),[2,h(function(n){r.messageTransceiver.port.postMessage(r.createMessage(d.from(t,"updateUserProperties",{operations:e.toRecord()},r.getBrowserProperties()))),r.resolverRecord.set(t,n)},{onTimeout:function(e){return e()}}).then(function(){r.emitUserUpdated()})]})})},s.prototype.updatePushSubscriptions=function(e){var t=this,r=this.createId();return h(function(n){t.messageTransceiver.port.postMessage(t.createMessage(d.from(r,"updatePushSubscriptions",{operations:e.toRecord()},t.getBrowserProperties()))),t.resolverRecord.set(r,n)},{onTimeout:function(e){return e()}})},s.prototype.updateSmsSubscriptions=function(e){var t=this,r=this.createId();return h(function(n){t.messageTransceiver.port.postMessage(t.createMessage(d.from(r,"updateSmsSubscriptions",{operations:e.toRecord()},t.getBrowserProperties()))),t.resolverRecord.set(r,n)},{onTimeout:function(e){return e()}})},s.prototype.updateKakaoSubscriptions=function(e){var t=this,r=this.createId();return h(function(n){t.messageTransceiver.port.postMessage(t.createMessage(d.from(r,"updateKakaoSubscriptions",{operations:e.toRecord()},t.getBrowserProperties()))),t.resolverRecord.set(r,n)},{onTimeout:function(e){return e()}})},s.prototype.setPhoneNumber=function(e){var t=this,r=this.createId();return h(function(n){t.messageTransceiver.port.postMessage(t.createMessage(d.from(r,"setPhoneNumber",{phoneNumber:e},t.getBrowserProperties()))),t.resolverRecord.set(r,n)},{onTimeout:function(e){return e()}})},s.prototype.unsetPhoneNumber=function(){var e=this,t=this.createId();return h(function(r){e.messageTransceiver.port.postMessage(e.createMessage(d.from(t,"unsetPhoneNumber",null,e.getBrowserProperties()))),e.resolverRecord.set(t,r)},{onTimeout:function(e){return e()}})},s.prototype.resetUser=function(){return n(this,void 0,void 0,function(){var e,t=this;return o(this,function(r){return e=this.createId(),[2,h(function(r){t.messageTransceiver.port.postMessage(t.createMessage(d.from(e,"resetUser",null,t.getBrowserProperties()))),t.resolverRecord.set(e,r)},{onTimeout:function(e){return e()}}).then(function(){t.emitUserUpdated()})]})})},s.prototype.variation=function(e){return n(this,void 0,void 0,function(){var t,r=this;return o(this,function(n){switch(n.label){case 0:return t=this.createId(),[4,h(function(n){r.messageTransceiver.port.postMessage(r.createMessage(d.from(t,"variation",{experimentKey:e},r.getBrowserProperties()))),r.resolverRecord.set(t,n)},{onTimeout:function(e){return e({variation:"A"})}})];case 1:return[2,n.sent().variation]}})})},s.prototype.variationDetail=function(t){return n(this,void 0,void 0,function(){var r,n,s,i,u,c=this;return o(this,function(o){switch(o.label){case 0:r=this.createId(),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,h(function(e){c.messageTransceiver.port.postMessage(c.createMessage(d.from(r,"variationDetail",{experimentKey:t},c.getBrowserProperties()))),c.resolverRecord.set(r,e)},{onTimeout:function(e,t){return t()}})];case 2:return n=o.sent(),s=n.variation,i=n.reason,u=n.parameters,[2,e.Decision.of(s,i,new f(null!=u?u:{}))];case 3:return o.sent(),[2,e.Decision.of("A",e.DecisionReason.EXCEPTION)];case 4:return[2]}})})},s.prototype.isFeatureOn=function(e){return n(this,void 0,void 0,function(){var t,r=this;return o(this,function(n){switch(n.label){case 0:return t=this.createId(),[4,h(function(n){r.messageTransceiver.port.postMessage(r.createMessage(d.from(t,"isFeatureOn",{featureKey:e},r.getBrowserProperties()))),r.resolverRecord.set(t,n)},{onTimeout:function(e){return e({isOn:!1})}})];case 1:return[2,n.sent().isOn]}})})},s.prototype.featureFlagDetail=function(t){return n(this,void 0,void 0,function(){var r,n,s,i,u,c=this;return o(this,function(o){switch(o.label){case 0:r=this.createId(),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,h(function(e){c.messageTransceiver.port.postMessage(c.createMessage(d.from(r,"featureFlagDetail",{featureKey:t},c.getBrowserProperties()))),c.resolverRecord.set(r,e)},{onTimeout:function(e,t){return t()}})];case 2:return n=o.sent(),s=n.isOn,i=n.reason,u=n.parameters,[2,new e.FeatureFlagDecision(s,i,new f(null!=u?u:{}),void 0)];case 3:return o.sent(),[2,e.FeatureFlagDecision.off(e.DecisionReason.EXCEPTION)];case 4:return[2]}})})},s.prototype.track=function(e){var t=this,r=this.createId();return h(function(n){t.messageTransceiver.port.postMessage(t.createMessage(d.from(r,"track",{event:e},t.getBrowserProperties()))),t.resolverRecord.set(r,n)},{onTimeout:function(e){return e()}})},s.prototype.trackPageView=function(){return n(this,void 0,void 0,function(){return o(this,function(e){return[2]})})},s.prototype.remoteConfig=function(){var e=this;return new l(function(t,r,n){var o=e.createId();return h(function(s){e.messageTransceiver.port.postMessage(e.createMessage(d.from(o,"remoteConfig",{key:t,defaultValue:r,valueType:n},e.getBrowserProperties()))),e.resolverRecord.set(o,s)},{onTimeout:function(e){return e(r)}})})},s.prototype.showUserExplorer=function(){var e=this,t=this.createId();return h(function(r){e.messageTransceiver.port.postMessage(e.createMessage(d.from(t,"showUserExplorer",null,e.getBrowserProperties()))),e.resolverRecord.set(t,r)},{onTimeout:function(e){return e()}})},s.prototype.hideUserExplorer=function(){return n(this,void 0,void 0,function(){var e,t=this;return o(this,function(r){return e=this.createId(),[2,h(function(r){t.messageTransceiver.port.postMessage(t.createMessage(d.from(e,"hideUserExplorer",null,t.getBrowserProperties()))),t.resolverRecord.set(e,r)},{onTimeout:function(e){return e()}})]})})},s.prototype.fetch=function(){var e=this,t=this.createId();return h(function(r){e.messageTransceiver.port.postMessage(e.createMessage(d.from(t,"fetch",null,e.getBrowserProperties()))),e.resolverRecord.set(t,r)},{onTimeout:function(e){return e()}})},s.prototype.getDisplayedInAppMessage=function(){return console.log("[DEBUG] Hackle: getDisplayedInAppMessage is not supported in React Native WebView environment."),Promise.resolve(null)},s}(s),y=function(t){function s(r,n){var o=t.call(this)||this;return o.client=e.createInstance(r,n),o}return r(s,t),s.prototype.emitUserUpdated=function(){this.emit("user-updated",JSON.stringify(this.getUser()))},s.prototype.getSessionId=function(){return Promise.resolve(this.client.getSessionId())},s.prototype.getUser=function(){return Promise.resolve(this.client.getUser())},s.prototype.setUser=function(e){return n(this,void 0,void 0,function(){var t=this;return o(this,function(r){return[2,Promise.resolve(this.client.setUser(e)).then(function(){t.emitUserUpdated()})]})})},s.prototype.setUserId=function(e){return n(this,void 0,void 0,function(){var t=this;return o(this,function(r){return[2,Promise.resolve(this.client.setUserId(e)).then(function(){t.emitUserUpdated()})]})})},s.prototype.setDeviceId=function(e){return n(this,void 0,void 0,function(){var t=this;return o(this,function(r){return[2,Promise.resolve(this.client.setDeviceId(e)).then(function(){t.emitUserUpdated()})]})})},s.prototype.setUserProperty=function(e,t){return n(this,void 0,void 0,function(){var r=this;return o(this,function(n){return[2,Promise.resolve(this.client.setUserProperty(e,t)).then(function(){r.emitUserUpdated()})]})})},s.prototype.setUserProperties=function(e){return n(this,void 0,void 0,function(){var t=this;return o(this,function(r){return[2,Promise.resolve(this.client.setUserProperties(e)).then(function(){t.emitUserUpdated()})]})})},s.prototype.updateUserProperties=function(e){return n(this,void 0,void 0,function(){var t=this;return o(this,function(r){return[2,Promise.resolve(this.client.updateUserProperties(e)).then(function(){t.emitUserUpdated()})]})})},s.prototype.updatePushSubscriptions=function(e){return Promise.resolve(this.client.updatePushSubscriptions(e))},s.prototype.updateSmsSubscriptions=function(e){return Promise.resolve(this.client.updateSmsSubscriptions(e))},s.prototype.updateKakaoSubscriptions=function(e){return Promise.resolve(this.client.updateKakaoSubscriptions(e))},s.prototype.setPhoneNumber=function(e){return Promise.resolve(this.client.setPhoneNumber(e))},s.prototype.unsetPhoneNumber=function(){return Promise.resolve(this.client.unsetPhoneNumber())},s.prototype.resetUser=function(){return n(this,void 0,void 0,function(){var e=this;return o(this,function(t){return[2,Promise.resolve(this.client.resetUser()).then(function(){e.emitUserUpdated()})]})})},s.prototype.variation=function(e){return Promise.resolve(this.client.variation(e))},s.prototype.variationDetail=function(e){return Promise.resolve(this.client.variationDetail(e))},s.prototype.isFeatureOn=function(e){return Promise.resolve(this.client.isFeatureOn(e))},s.prototype.featureFlagDetail=function(e){return Promise.resolve(this.client.featureFlagDetail(e))},s.prototype.track=function(e){return Promise.resolve(this.client.track(e))},s.prototype.trackPageView=function(e){return Promise.resolve(this.client.trackPageView(e))},s.prototype.remoteConfig=function(){var e=this;return new l(function(t,r,n){var o=e.client.remoteConfig().get(t,r);return Promise.resolve({configValue:o})})},s.prototype.showUserExplorer=function(){return Promise.resolve(this.client.showUserExplorer())},s.prototype.hideUserExplorer=function(){return Promise.resolve(this.client.hideUserExplorer())},s.prototype.fetch=function(){return Promise.resolve(this.client.fetch())},s.prototype.onInitialized=function(e){return this.client.onInitialized(e)},s.prototype.getDisplayedInAppMessage=function(){return Promise.resolve(this.client.getDisplayedInAppMessageView())},s}(s);return v});
